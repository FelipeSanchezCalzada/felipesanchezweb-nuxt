# I want a job that run pnpm install and pnpm run build
# and then build de Docker image and push it to the registry
# and then deploy the app to docker-compose

image: node:18-alpine
stages:
  - build
  - dockerize
  - deploy

build-nuxt-app:
  stage: build
  script:
    - npm install -g pnpm
    - pnpm install
    - pnpm run build

dockerize-app:
  stage: dockerize
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  before_script:
    - docker info
  script:
    - docker build -t felipesanchezweb-nuxt .